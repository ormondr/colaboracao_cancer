 
# excluir positions duplicadas e separar o alvo por cromossomos 
# fazer isso para as duas coortes


##só listei e não excclui nenhuma pois não tinha

for i in {1..22}; do plink --bfile ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i} --list-duplicate-vars; done

for i in {1..22}; do plink2 --bfile alvo_cancer_plink/dirce_5placas_chr${i} --list-duplicate-vars; done

#Garantindo o mesmo num de SNPS nos dois arquivos e garantindos que nao há alelos trocados

for i in {1..22}; do plink --bfile alvo_cancer_plink/dirce_5placas_chr${i} --extract ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}.bim --make-bed --out alvo_cancer_plink/dirce_5placas_chr${i}_pre; done

for i in {1..22}; do plink --bfile ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i} --extract alvo_cancer_plink/dirce_5placas_chr${i}.bim --make-bed --out ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_pre; done

#Extraindo as multialelicas antes de realizar o merge

for i in {1..22}; do plink --bfile alvo_cancer_plink/dirce_5placas_chr${i}_pre --snps-only just-acgt --make-bed --out alvo_cancer_plink/dirce_5placas_chr${i}_pre2; done

for i in {1..22}; do plink --bfile ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_pre --snps-only just-acgt --make-bed --out ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_pre2; done

# Juntando e fazendo o QC para ser utilizado depois para o ADMIXTURE.
#Juntar os arquivos, alvo e referência

for i in {1..22}; do plink --bfile alvo_cancer_plink/dirce_5placas_chr${i}_pre2 --bmerge ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_pre2 --make-bed --out alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}; done

##### Quando há pelo menos uma variante com mais de 2 alelos, é gerada uma lista de variantes em plink.missnp

# Nesse caso, como não gerou esse arquivo em todos os cromossomos, resolvemos excluir esses snps 

#Primeiro eu copiei os arquivos dos cromossomos que precisaria excluir como “cmissnp”, isso pro bed, bim e fam, ex:
#fiz isso para os cromossomos 19, 18, 17, 14, 12, 11, 9, 8, 7, 6, 5, 2, 1
#fiz tanto na amostra ref quanto na alvo
cp ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr19_pre2.bed ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr19_cmissnp.bed

cp ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr19_pre2.bim ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr19_cmissnp.bim

cp ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr19_pre2.fam ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr19_cmissnp.fam



##aqui eu excluo os arquivos gerados no missnp, como eu coloco em loop, os cromossomos que não geraram vao dar erro, mas tudo bem
#salvei os arquivos que tinham missnps como estava antes 

for i in {1..22}; do plink --bfile ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_cmissnp --exclude alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}-merge.missnp --make-bed --out ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_pre2; done

for i in {1..22}; do plink --bfile alvo_cancer_plink/dirce_5placas_chr${i}_cmissnp --exclude alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}-merge.missnp --make-bed --out alvo_cancer_plink/dirce_5placas_chr${i}_pre2; done

##agora eu junto os dois arquivos p[ara finalmente fazer o qc 

for i in {1..22}; do plink --bfile alvo_cancer_plink/dirce_5placas_chr${i}_pre2 --bmerge ref_eur_nat_afr_jap/IBS_YRI_JPT_NAT_chr${i}_pre2 --make-bed --out alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}; done


##faço um controle de qualidade básico e no maf eu só tiro as vars muito raras


for i in {1..22}; do plink2 --bfile alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i} –maf 0.001 --geno 0.1 --hwe 0.000001 --make-bed --out alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}_qc1 ; done

for i in {1..22}; do plink2 --bfile alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}_qc1 --mind 0.1 --make-bed --out alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr${i}_qced; done

### calculo de ancestralidade GLOBAL


/mnt/genetica_1/Phasing/admixture_linux-1.3.0/admixture alvo_ref_nat_eur_afr_jap/pre_ac_5placas_refs4anc_chr22_qced.bed 4 -j12
